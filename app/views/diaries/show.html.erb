<div class="container_fuluid mx-3">
  <div class="row my-2">
    <!--日記-->
    <h1><%= @diary.my_dog.name %>ちゃんの<%= @diary.diary_date %>の日記</h1>
    <%= image_tag @diary.my_dog.get_dog_image(80,80) %>
  </div>
  <div class="row justify-content-center">
    <div class="col-lg-6 col-11">
      <div class="row">
        <div class="col-12">
          <span class="h4 font-weight-bold border-bottom border-pink-thick">今日のひとこと</span><br>
        </div>
      </div>
      <div class="row mt-3">
        <div class="diary-memo col-11 border border-pink w-75" style="height: 150px;">
          <!--<td class="diary-memo py-1 px-0" style="max-height: 30px;">-->
          <span><%= @diary.memo %></span>
        </div>
      </div>
      <table class="table table-borderless">
        <tr>
          <th class="py-1 px-0">食欲</th>
          <td class="py-1 px-0"><%= @diary.appetite_i18n %></td>
        </tr>
        <tr>
          <th class="py-1 px-0">排せつ</th>
          <td class="py-1 px-0"><%= @diary.excreta_i18n %></td>
        </tr>
        <tr>
          <th class="py-1 px-0"></th>
          <td class="py-1 px-5 row justify-content-end">
            <%= link_to "内容を変更する", edit_diary_path(@diary.id), class: "btn btn-lightpink font-weight-bold text-success" %>
          </td>
        </tr>
      </table>
      <!--写真-->
      <div class="row mt-3">
        <div class="col-12">
          <span class="h4 font-weight-bold border-bottom border-pink-thick">今日の写真</span><br>
          <% if @photos.present? %>
            <div class="row mt-3">
              <% @photos.each do |photo| %>
                <!--写真詳細画面へ遷移する-->
                <%= link_to photo_path(photo.id) do %>
                  <div class="col-12">
                    <div style="width: 110px; min-height: 110px;"><%= image_tag photo.get_image(100,100) %></div>
                    <div class="daiary-photo" style="width: 110px;"><%= photo.title %></div>
                  </div>
                <% end %>
              <% end %>
            </div>
            <div class="row mt-2 px-5 justify-content-end">
              <!--写真一覧へ遷移する-->
              <%= link_to "もっと見る", photos_path, class: "btn btn-lightpink font-weight-bold text-success" %>
            </div>
          <% else %>
            <div class="row my-5">
              <span class="ml-5">写真がありません</span>
            </div>
          <% end %>
          <%= paginate @photos %>
        </div>
      </div>
      <div class="row mt-2">
        <div class="col-12">
          <span class="mb-0 h5 font-weight-bold border-bottom border-pink">写真の追加</span>
          <%= form_with model: @photo do |f| %>
            <table class="table table-borderless">
              <tr>
                <th>タイトル</th>
                <td><%= f.text_field :title %></td>
              </tr>
              <tr>
                <th>コメント</th>
                <td><%= f.text_area :body %></td>
              </tr>
              <tr>
                <th>写真</th>
                <td><%= f.file_field :image, accept: "image/*" %></td>
                <%= f.hidden_field :diary_id, :value => @diary.id %>
                <%= f.hidden_field :my_dog_id, :value => @diary.my_dog.id %>
              </tr>
              <tr>
                <th></th>
                <td><%= f.submit "保存", class: "btn btn-lightpink font-weight-bold text-success" %></td>
              </tr>


              <div class="media position-relative">
                <div class="diaries-image jumbotron m-0" style="width: 200px; min-height: 200px;"></div>
              </div>


            </table>
          <% end %>
        </div>
      </div>
    </div>
    <!--散歩情報-->
    <div class="col-lg-5 col-12 border-left border-pink">
      <table class="table table-borderless">
        <tr>
          <th colspan="2" class="py-3 px-0">
            <span class="h4 font-weight-bold border-bottom border-pink-thick"><%= @diary.my_dog.name %>ちゃんの散歩</span>
          </th>
        </tr>
        <tr>
          <th class="py-1 px-0"></th>
          <td class="py-1 px-0 row justify-content-end">
            <%= link_to "散歩情報を登録する", new_stroll_path(diary_id: @diary.id, dog_id: @diary.my_dog.id), class: "btn btn-lightpink font-weight-bold text-success" %>
          </td>
        </tr>
        <% @strolls.each_with_index do |stroll, index| %>
          <tr>
            <th colspan="2" class="py-2 px-0">
              <span class="h5 font-weight-bold border-bottom border-pink"><%= index + 1 %>回目の散歩</span>
            </th>
          </tr>
          <tr>
            <th class="py-1 px-0">元気の良さ</th>
            <td class="py-1 px-0"><%= stroll.vitality_condition_i18n %></td>
          </tr>
          <tr>
            <th class="py-1 px-0" style="max-height: 30px;">散歩メモ</th>
            <td class="diary-memo py-1 px-0" style="max-height: 30px;"><%= stroll.memo %></td>
          </tr>
          <tr>
            <th class="py-1 px-0">開始時間</th>
            <td class="py-1 px-0"><%= stroll.start_time.strftime("%H:%M") %></td>
          </tr>
          <tr>
            <th class="py-1 px-0">終了時間</th>
            <td class="py-1 px-0"><%= stroll.end_time.strftime("%H:%M") %></td>
          </tr>
          <tr>
            <th class="py-1 px-0"></th>
            <td class="py-1 px-0 row justify-content-end">
              <%= link_to "散歩情報を変更する", edit_stroll_path(stroll.id), class: "btn btn-lightpink font-weight-bold text-success" %>
            </td>
          </tr>
          <% if stroll.pins.present? %>
            <tr>
              <th class="py-1 px-0">お散歩ルート</th>
              <td class="py-1 px-0">
                <%= stroll.pins.order(updated_at: :desc).first.title %>
              </td>
            </tr>
            <tr>
              <th class="py-1 px-0">お散歩距離</th>
              <td class="py-1 px-0">
                <!--1回の散歩ごとの散歩距離（複数のポリラインの合計距離）-->
                <% total = 0 %>
                <% stroll.pins.all.each do |pin| %>
                  <% total += pin.distance %>
                <% end %>
                <%= total.to_i %> m
              </td>
            </tr>
            <tr>
              <th class="py-1 px-0">お散歩時間</th>
              <td class="py-1 px-0"><%= stroll.time_of_stroll %> 分</td>
            </tr>
            <tr>
              <th class="py-1 px-0">スピード</th>
              <td class="py-1 px-0">
                <%= total.to_i / stroll.time_of_stroll %> m／分
              </td>
            </tr>
            <tr>
              <th class="py-1 px-0"></th>
              <td class="py-1 px-0 row justify-content-end">
                <%= link_to "お散歩ルートを地図で確認する", stroll_path(stroll.id), class: "btn btn-lightpink font-weight-bold text-success" %>
              </td>
            </tr>
          <% else %>
            <tr>
              <th class="py-1 px-0">お散歩ルートを登録してください</th>
              <td class="py-1 px-0 row justify-content-end">
                <%= link_to "散歩ルートを登録する", new_pin_path(stroll_id: stroll.id), class: "btn btn-lightpink font-weight-bold text-success" %>
              </td>
            </tr>
          <% end %>
        <% end %>
        <tr>
          <th colspan="2" class="py-2 px-0">
            <span class="h5 font-weight-bold border-bottom border-pink">今日の合計</span>
          </th>
        </tr>
        <tr>
          <th class="py-1 px-0">距離</th>
          <td class="py-1 px-0"><%= @total_distances.to_i %> m</td>
        </tr>
        <tr>
          <th class="py-1 px-0">時間</th>
          <td class="py-1 px-0"><%= @total_min %> 分</td>
        </tr>
        <% if @total_min > 0 %>
          <tr>
            <th class="py-1 px-0">スピード</th>
            <td class="py-1 px-0">
              <%= @total_distances.to_i / @total_min %> m／分
            </td>
          </tr>
        <% end %>
      </table>
    </div>
  </div>
</div>